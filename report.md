Аналіз безпекових ризиків при неконтрольованих змінах (лабораторний кейс)

Короткий огляд

Розглядається випадок: зміна в `test_app.py`, внесена без рев'ю і підпису в `main`, що спричинила фейл CI. Мета — виявити порушення політик, змоделювати можливий інцидент, запропонувати превентивні заходи й підготувати звернення до команди.

1. Вступ

Кейс: неконтрольована зміна в тестовому модулі (`test_app.py`) потрапила в основну гілку напряму (push в `main`) і викликала збій pipeline. За умовами лабораторної роботи зміна виконана без MR і без підпису коміту.

2. Технічний аналіз зміни

Примітка: у робочій теці відсутній реальний `test_app.py`, тому нижче — реконструкція і аналіз на основі опису кейсу.

Реконструйований фрагмент зміни (приклад)

```diff
- def test_requires_auth(client):
-     resp = client.get('/admin')
-     assert resp.status_code == 401
+ def test_requires_auth(client):
+     resp = client.get('/admin')
+     assert resp.status_code = 401   # <- синтаксична помилка, CI фейл
```

Що сталося (коротко): зміна містить помилку, що призвела до помилки тесту/синтаксису і зупинила pipeline. Ключова проблема — зміну було запушено напряму в `main` без рев'ю, тому автоматичний контроль якості не спрацював на етапі перегляду коду.

Виявлені порушення політик

- Прямий push у `main` (без MR / без peer review).
- Коміт не підписаний (відсутність GPG/SSH-підписів).
- Відсутність захищених гілок/політик, які забороняють прямі пуші.
- Неможливість автоматичного блокування merge для помилкових/ненадійних змін.

Для кожного порушення — ризики та наслідки

- Відсутність рев'ю
  - Ризик: пропуск помилок і вразливостей у коді; можливість інсайдерських/злочинних змін.
  - Наслідки: регресія, інцидент безпеки, витік даних.
  - SSDLC: порушено stage "secure code review" (shift-left й assurance).

- Відсутність підпису коміту
  - Ризик: неможливо достовірно відслідкувати авторство/підробку.
  - Наслідки: ускладнений інцидент-реагування, юридичні ризики.
  - SSDLC: порушено вимоги цілісності поставки.

- Відсутність захищених гілок / CI-гейтів
  - Ризик: автоматичні перевірки не гарантують, що лише перевірений код потрапляє у реліз.
  - Наслідки: продуктивне середовище може отримати небезпечні зміни.
  - SSDLC: порушено контроль релізів та випусків.

3. Перевірка автентичності

Сценарій перевірки (команди):
- git log --show-signature <commit>
- git verify-commit <commit>

Результат (за умовами кейсу): підпису немає — коміт не підписаний; доведення авторства вимагає додаткових логів або перевірки CI/SSH-трафіку.

4. Оцінка відповідності політикам SCM

Коротко: зміна не відповідає базовим політикам хорошого SCM (захищені гілки, MR з мінімум 1–2 approve, підписані коміти, автоматичні CI-гейти). Це — системна прогалина у процесі прийняття змін.

5. Моделювання інциденту (реалістичний сценарій)

Сценарій "обхід авторизації через неконтрольовану зміну":
- Атакуючий або неуважний розробник вносить зміну в тест або код, яка послаблює перевірку ролей (наприклад, функція is_admin завжди повертає True).
- Зміна запушена напряму в `main` без MR.
- CI падав раніше через синтаксичну помилку, але нападник вносить іншу зміну, яка приховує проблему — pipeline проходить або його обійшли.
- У продакшн потрапляє версія з ослабленою авторизацією.

Чому не виявлено:
- Відсутність peer review; автоматичні SAST/DAST не налаштовані або не охоплюють певні логічні перевірки.

Наслідки:
- Несанкціонований доступ до даних користувачів.
- Фінансові втрати, шкода репутації, можливі судові наслідки.

6. Розробка превентивної стратегії (технічні + організаційні)

Технічні заходи
- Захищені гілки (`main`/`master`) — заборона прямих push, вимога MR.
- Мінімум 1–2 approvers у MR; застосувати `CODEOWNERS` для критичних зон.
- Вимога "pipeline must pass" для merge (статичний аналіз, unit tests, security scans).
- Enforce signed commits (GPG/SSH) або CI-валідатор підписів.
- Додавання SAST (Bandit), dependency scan (Safety/Trivy), secrets-detection (gitleaks/TruffleHog) у CI.
- Pre-commit hooks для локального фільтрування (flake8, bandit).

Організаційні заходи
- Політика "no direct push to main" + onboarding з правилом MR.
- Регулярні code-review сесії і тренінги по SSDLC.
- Плейбук інцидент-реагування + post-mortem для будь-яких проникнень.

7. Формування культури відповідальності — звернення до команди (до 200 слів)

Колеги,

аудит змін — це не бюрократія; це наша перша лінія захисту. Кожний MR — можливість помітити помилку, запобігти вразливості і зберегти довіру користувачів. Прохання: перед пушем до `main` робіть MR, додавайте мінімум одного рев'юера, запускайте локальні pre-commit перевірки і валідуйте результати CI. Якщо бачите сумнівні зміни — зупиніться і уточніть. Ми відповідаємо за якість коду так само, як за безпеку продукту.

8. Висновки

Неналежний контроль змін створює значні операційні й безпекові ризики. Простими, але суворо виконуваними кроками — захищені гілки, MR-процес, підписані коміти і CI-гейти — можна істотно знизити ймовірність інциденту. Виконане завдання містить повний набір рекомендацій для негайної реалізації.

Додатки
- Короткий чекліст дій: захистити `main`, додати `CODEOWNERS`, вимагати pipeline success, встановити pre-commit.
