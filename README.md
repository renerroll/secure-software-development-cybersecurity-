# Secure Architecture Lab ‚Äî –≤–∏–∫–æ–Ω–∞–Ω—ñ –∫—Ä–æ–∫–∏ —Ç–∞ –ø—ñ–¥—Å—É–º–æ–∫ –∞–Ω–∞–ª—ñ–∑—É

## –ö–æ—Ä–æ—Ç–∫–æ
–¶—è –≥—ñ–ª–∫–∞ –º—ñ—Å—Ç–∏—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–µ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–µ —Ä–µ–≤ º—é —à–∞–±–ª–æ–Ω—É: –∞–Ω–∞–ª—ñ–∑ —Ñ–∞–π–ª—ñ–≤ –ø—Ä–æ—î–∫—Ç—É, `report.md` –∑ —Ä–æ–∑–±–æ—Ä–æ–º –ø—Ä–æ–±–ª–µ–º —ñ –ø—Ä–æ–ø–æ–∑–∏—Ü—ñ—è–º–∏, –∞ —Ç–∞–∫–æ–∂ –ø—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å —É –ø–∞–ø—Ü—ñ `fix/`.

---

## –©–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ 
- `main.py` ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–∏–ø—ñ–∑–∞—Ü—ñ—ó, –ª–æ–≥—ñ–∫–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó, —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
- `deployment.yaml` ‚Äî —Å–µ–∫—Ä–µ—Ç–∏, probes, securityContext
- `main.tf` ‚Äî –º–µ—Ä–µ–∂–µ–≤—ñ –ø—Ä–∞–≤–∏–ª–∞ (Security Group)
- `ci.yml` ‚Äî –Ω–∞—è–≤–Ω—ñ—Å—Ç—å SCA / SAST / secret-scan
- `Dockerfile` ‚Äî –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á, –ø–æ—Ä—Ç, pinned deps
- `task.md` ‚Äî –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–æ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–∏—Ö –∫—Ä–æ–∫—ñ–≤ –∑–∞–≤–¥–∞–Ω–Ω—é

---

## –ö–æ—Ä–æ—Ç–∫–∏–π –ø–µ—Ä–µ–ª—ñ–∫ –≤–∏—è–≤–ª–µ–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º (–º—ñ–Ω—ñ–º—É–º 5)
1. –í—ñ–¥—Å—É—Ç–Ω—è —Ç–∏–ø—ñ–∑–∞—Ü—ñ—è / `response_model` / OpenAPI ‚Äî `main.py`
2. –•–∞—Ä–¥–∫–æ–¥/–Ω–µ–Ω–∞–¥—ñ–π–Ω–∞ –∞–≤—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—è —Ç–∞ unsafe parsing ‚Äî `main.py`
3. –ù–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –ø–æ—Ä—Ç—ñ–≤ —ñ –≤—ñ–¥—Å—É—Ç–Ω—è `readinessProbe` ‚Äî `Dockerfile` ‚Üî `deployment.yaml`
4. –°–µ–∫—Ä–µ—Ç–∏ –ø—ñ–¥–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –Ω–µ–∫–æ–Ω—Ç—Ä–æ–ª—å–æ–≤–∞–Ω–æ (`envFrom`) ‚Äî `deployment.yaml`
5. CI –Ω–µ –º—ñ—Å—Ç–∏—Ç—å SCA / SAST / secret-scan (Trivy/Syft/Semgrep/Gitleaks) ‚Äî `ci.yml`
6. Security Group –≤—ñ–¥–∫—Ä–∏—Ç–∏–π –Ω–∞ `0.0.0.0/0` ‚Äî `main.tf`

---

## –ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏, —è–∫—ñ —Å—Ç–≤–æ—Ä–µ–Ω–æ/–æ–Ω–æ–≤–ª–µ–Ω–æ üîß
- `report.md` ‚Äî –ø–æ–≤–Ω–∏–π –∑–≤—ñ—Ç –∑ –∫–æ–∂–Ω–æ—é –ø—Ä–æ–±–ª–µ–º–æ—é —Ç–∞ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º–∏
- –ü–∞–ø–∫–∞ `fix/` —ñ–∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏ –∑–º—ñ–Ω:
  - `fix/main.py` (Pydantic, response_model, –ª–æ–≥—É–≤–∞–Ω–Ω—è)
  - `fix/Dockerfile` (non-root, –ø–æ—Ä—Ç 8080, pinned deps)
  - `fix/deployment.yaml` (secretKeyRef, probes, securityContext)
  - `fix/main.tf` (–∑–º—ñ–Ω–Ω–∞ `allowed_cidr` –∑–∞–º—ñ—Å—Ç—å `0.0.0.0/0`)
  - `fix/ci.yml` (–ø—Ä–∏–∫–ª–∞–¥–∏ job-—ñ–≤ –¥–ª—è SBOM/Trivy/Semgrep/Gitleaks)
  - `fix/requirements.txt`

---

## –í—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å –ø—É–Ω–∫—Ç–∞–º `task.md` 
- –ü—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ ‚Äî  (—Ñ–∞–π–ª–∏ –ø–µ—Ä–µ–≥–ª—è–Ω—É—Ç—ñ –ª–æ–∫–∞–ª—å–Ω–æ)
- –ß–∞—Å—Ç–∏–Ω–∞ 1 (–∞—É–¥–∏—Ç) ‚Äî  (–∞–Ω–∞–ª—ñ–∑ `main.py`, `deployment.yaml`, `main.tf`, `ci.yml`, `Dockerfile`)
- –ß–∞—Å—Ç–∏–Ω–∞ 2 (–∑–≤—ñ—Ç) ‚Äî  (`report.md` —Å—Ç–≤–æ—Ä–µ–Ω–æ —É –∫–æ—Ä–µ–Ω—ñ)
- –ß–∞—Å—Ç–∏–Ω–∞ 3 (fix/) ‚Äî  (–ø—Ä–∏–∫–ª–∞–¥–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å —É `fix/`)
- –ß–∞—Å—Ç–∏–Ω–∞ 4 (–ø–µ—Ä–µ–¥–∞—á–∞) ‚Äî (–ø–æ—Ç—Ä—ñ–±–Ω–æ: ZIP –¥–ª—è LMS –∞–±–æ PR ‚Äî –æ–±–µ—Ä—ñ—Ç—å –æ–ø—Ü—ñ—é)

---

## –Ø–∫ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ –ª–æ–∫–∞–ª—å–Ω–æ (–∫–æ—Ä–æ—Ç–∫–æ) ‚ñ∂Ô∏è
- –ó—ñ–±—Ä–∞—Ç–∏ –æ–±—Ä–∞–∑: `docker build -t user-api .`
- –ó–∞–ø—É—Å—Ç–∏—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä: `docker run -e AUTH_SECRET=secret -p 8080:8080 user-api`
- –ü—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ –µ–Ω–¥–ø–æ—ó–Ω—Ç–∏: `curl "http://localhost:8080/user?id=1"`

–Ø–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ñ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏:
- SBOM: `syft user-api:latest -o json`
- Image scan: `trivy image user-api:latest`
- SAST: `semgrep --config auto .`

---

## –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω—ñ –Ω–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏
1. –ó–∞–∫–æ–º—ñ—Ç–∏—Ç–∏ –∑–º—ñ–Ω–∏ –≤ –æ–∫—Ä–µ–º—É –≥—ñ–ª–∫—É —ñ –≤—ñ–¥–∫—Ä–∏—Ç–∏ PR (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ).  
2. –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ Trivy/Syft/Semgrep/Gitleaks –≤ CI.  
3. –ú—ñ–≥—Ä–∞—Ü—ñ—è —Å–µ–∫—Ä–µ—Ç—ñ–≤ –¥–æ Vault/CSI + –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `secretKeyRef`.  
4. –û–±–º–µ–∂–∏—Ç–∏ `allowed_cidr` —É `main.tf` —ñ –¥–æ–¥–∞—Ç–∏ network ACLs.

---

## –ö–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç (quiz)

1. **–Ø–∫–∏–π —Ñ–∞–π–ª –Ω–∞–π–∫—Ä–∞—â–µ —Å–ª—É–∂–∏—Ç—å —Å–∏–≥–Ω–∞–ª–æ–º –¥–ª—è DAST-—Å–∫–∞–Ω–µ—Ä–∞?**

   **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** `yaml` (OpenAPI) ‚Äî DAST –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î OpenAPI/schema –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –∑–∞–ø–∏—Ç—ñ–≤ —ñ fuzzing.

2. **Policy-as-Code –¥–∞—î –∑–º–æ–≥—É –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ –±—É–¥—å-—è–∫–∏–π YAML-—Ñ–∞–π–ª, –∑–æ–∫—Ä–µ–º–∞ Helm-—à–∞–±–ª–æ–Ω–∏?**

   **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** **–¢–∞–∫** ‚Äî OPA/Conftest –º–æ–∂—É—Ç—å –ø–∞—Ä—Å–∏—Ç–∏ –π –ø–µ—Ä–µ–≤—ñ—Ä—è—Ç–∏ YAML-—Å—Ç—Ä—É–∫—Ç—É—Ä–∏.

3. **–ü—Ä–∏–∫–ª–∞–¥ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–Ω–æ–≥–æ —Å–∏–≥–Ω–∞–ª—É –¥–ª—è supply-chain –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫?**

   **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** SBOM (JSON / SPDX) ‚Äî —Å–∏–≥–Ω–∞–ª –¥–ª—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤ SCA.

4. **–©–æ –ø–æ—Ä—É—à—É—î –ø—Ä–∏–Ω—Ü–∏–ø –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏—Ö –ø—Ä–∏–≤—ñ–ª–µ—ó–≤ (PoLP)?**

   **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** IAM-role –∑ –¥–æ–∑–≤–æ–ª–æ–º `*:*` ‚Äî –Ω–∞–¥—Ç–æ —à–∏—Ä–æ–∫—ñ –ø—Ä–∞–≤–∞.

5. **–ü—Ä–∏–∫–ª–∞–¥ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∑–∞—Å—Ç–æ—Å—É–≤–∞–Ω–Ω—è CSI + Vault?**

   **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** `volumeMount` (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `/mnt/secrets-store`) ‚Äî —Å–µ–∫—Ä–µ—Ç–∏ –º–æ–Ω—Ç—É—é—Ç—å—Å—è —è–∫ —Ñ–∞–π–ª–∏.

6. **–©–æ –æ–ø–∏—Å—É—î Secure-by-Design?**

   **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** –°–∏—Å—Ç–µ–º–∞ –ø–æ–±—É–¥–æ–≤–∞–Ω–∞ —Ç–∞–∫, —â–æ –≤ –Ω—ñ–π —É—Å–µ –º–∞—î –ø—Ä–æ–π—Ç–∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ (–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –≤–±—É–¥–æ–≤–∞–Ω—ñ –≤ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä—É).

7. **–Ø–∫—â–æ –≤ Helm `deployment.yaml` —î `value: "sk_live_ABC123"`, —Ç–æ Vault CSI –ø—Ä–∞–≤–∏–ª—å–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ?**

   **–í—ñ–¥–ø–æ–≤—ñ–¥—å:** **–ù—ñ** ‚Äî plaintext —É —à–∞–±–ª–æ–Ω—ñ ‚Äî –∞–Ω—Ç–∏–ø–∞—Ç–µ—Ä–Ω.

---

